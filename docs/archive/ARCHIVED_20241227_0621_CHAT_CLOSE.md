# Closing a Development Session

> **IMPORTANT**: The [Development Session Checklist](DEV_SESSION_CHECKLIST.md) is the authoritative source for development session procedures. This document provides additional context and detailed explanations for the checklist items.

## Important Guidelines
1. Once the closing process begins:
   - DO NOT make any new code changes
   - DO NOT attempt to fix issues discovered during closing
   - Instead, document all issues in NEXT_SESSION.md and `docs/BACKLOG.md`
   - Revert any changes made during the closing process

2. If issues are discovered:
   - Add them to the "Issues and Blockers" section in NEXT_SESSION.md
   - Add corresponding tasks to `docs/BACKLOG.md` with appropriate priority
   - Document any temporary workarounds or important context

## Close Process Steps

### 1. Pre-Close Verification (Required)
```bash
# Check for uncommitted changes
git status

# Run tests
python -m pytest

# Get test coverage report
pytest --cov
```
- If any checks fail, fix issues or document them before proceeding
- Commit any final changes before starting close process

### 2. Gather Session Metrics
```bash
# Get recent changes for reference
git log --oneline -n 5
git diff --name-status HEAD~1

# Get test coverage report
pytest --cov

# List any new dependencies
pip freeze > requirements.txt.new
diff requirements.txt requirements.txt.new
```
- Use these metrics to inform the manual session log
- Keep requirements.txt.new for reference

### 3. Update Documentation (In Order)
1. **Update `docs/BACKLOG.md`**
   - Add any incomplete tasks
   - Update status of completed tasks
   - Add new tasks discovered during session
   - Commit changes

2. **Create Session Log**
   - Create `docs/sessions/session_YYYYMMDD_HHMM.md`
   - Use gathered metrics to inform content
   - Include technical decisions and rationale
   - Reference `docs/BACKLOG.md` tasks
   - Commit changes

3. **Run Automated Close**
   - Run `python chat_session_manager.py close`
   - Review generated NEXT_SESSION.md
   - Make any necessary adjustments
   - Commit changes

### 4. Final Verification
```bash
# Verify all changes are committed
git status

# Verify tests still pass
python -m pytest

# Push changes
git push origin main
```

## Session Documentation Types

1. **Manual Session Log** (Required First)
   - Created by the developer/AI
   - Captures narrative, context, and decision-making
   - Located in `docs/sessions/session_YYYYMMDD_HHMM.md`
   - Provides detailed explanations of changes and rationale
   - Should be created and committed before running automated close

2. **Automated Session Close** (Required Second)
   - Generated by `chat_session_manager.py close`
   - Captures metrics, test status, and environment changes
   - Updates NEXT_SESSION.md with automated insights
   - Provides objective data about the session
   - Should be run after the manual session log is committed

## Manual Session Log Template
Use this template when creating `session_YYYYMMDD_HHMM.md`:
```markdown
## Session Summary YYYY-MM-DD HH:MM TZ

### Completed Tasks
- [List of completed tasks with PR/commit references]

### Code Changes
- [List of modified files with brief descriptions]
- [Any new files or deleted files]
- [Database schema changes]

### Environment Changes
- [New dependencies added]
- [Configuration changes]
- [Database migrations]

### Issues and Blockers
- [Any unresolved issues]
- [Technical debt introduced]
- [Dependencies on other tasks]

### Testing Status
- [Tests added/modified]
- [Test coverage changes]
- [Manual testing performed]

### Technical Decisions
- [Key decisions made during the session]
- [Rationale behind important changes]
- [Alternative approaches considered]
```

## Troubleshooting

### Common Issues
1. **Failed Tests**
   - Document failing tests in `docs/BACKLOG.md`
   - Add test failures to session log
   - Note any temporary workarounds

2. **Uncommitted Changes**
   - Review changes carefully
   - Commit logical groups separately
   - Document reasons for any postponed commits

3. **Documentation Discrepancies**
   - Ensure `docs/BACKLOG.md` and session log align
   - Cross-reference tasks and changes
   - Update both if discrepancies found

## Final Message Template
```
Session completed! Here's a summary:

1. Completed Tasks:
   - [List tasks]

2. Changes Made:
   - [List significant changes]

3. Next Steps:
   - [List immediate next steps]

4. Updated Documentation:
   - NEXT_SESSION.md
   - [Other docs]

All changes have been committed and pushed. The project is ready for the next session.

## Pre-Close Checklist

### 1. Documentation Updates
- [ ] Update NEXT_SESSION.md
  - Add recent changes
  - Document current state
  - List issues and blockers
  - Define next steps
- [ ] Update `docs/BACKLOG.md`
  - Add new tasks discovered
  - Update priorities
  - Add technical debt items

### 2. Git Status
- [ ] Review uncommitted changes
- [ ] Commit or revert changes
- [ ] Push final commits

### 3. Final Review
- [ ] All files saved
- [ ] All changes committed
- [ ] Documentation updated
- [ ] Next steps clear

## Common Close-out Commands
```bash
# Format code
black .

# Run type checks
mypy .

# Run tests
python -m pytest

# Check git status
git status

# View changes
git diff

# Commit changes
git add .
git commit -m "type: description"

# Push changes
git push origin main

# Update documentation
python update_docs.py  # if available
